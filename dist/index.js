class Event{isFunction(t){return t&&"[object Function]"==={}.toString.call(t)}trigger(t,...e){const s=null!=this._events?this._events[t]:void 0;null!=s&&this._triggerEvents(s,...Array.from(e));const n=null!=this._events?this._events.all:void 0;return null!=n&&this._triggerEvents(n,t,...Array.from(e)),this}on(t,e){if(null==this._events&&(this._events={}),!this.isFunction(e))throw new Error("Must have a valid function callback");if(/\s/g.test(n))throw new Error("Illegal event name");const s=t.split(" ");for(var n of Array.from(s)){(this._events[n]||(this._events[n]=[])).push({callback:e,self:this})}return this}off(t,e){if(null==this._events&&(this._events={}),null==e)return this._events={},this;for(t of Array.from(t.split(" "))){const s=null!=this._events[t]?this._events[t]:[],n=t?[t]:Array.from(this._events);for(t of Array.from(n)){const n=[];this._events[t]=n;for(let t of Array.from(s))e!==t.callback&&n.push(t);0===n.length&&delete this._events[t]}}return this}_triggerEvents(t,...e){return Array.from(t).map(t=>t.callback(...Array.from(e||[])))}}class WebsocketConnection{constructor(t,e){this.host=t,this.log=e,this.events=new Event,this.readyState=0}on(t,e){this.events.on(t,e)}off(t,e){this.events.off(t,e)}connect(){this.readyState=0;const t=new WebSocket(this.host);return t.binaryType="arraybuffer",t.onopen=(()=>this._onOpen()),t.onclose=(()=>this._onClose()),t.onerror=(t=>this._onError(t)),t.onmessage=(t=>this._onMessage(t)),this.connection=t}close(){return this.connection.close()}send(t){if(t instanceof Uint8Array||t instanceof Blob)return this.connection.send(t);console.error("Payload to send() must be Uint8Array or blob")}_onMessage(t){return this.events.trigger("message",t.data)}_onOpen(t){return this.log.log("flux: opened"),this.readyState=1,this.events.trigger("open",this)}_onClose(t){return this.log.log("flux: closed"),this.readyState=2,this.events.trigger("close",this)}_onError(t){return null!=this.log&&this.log.log("flux: we have a error:",t),this.events.trigger("error",this)}}export{WebsocketConnection};